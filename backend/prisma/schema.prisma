datasource db {
  provider = "postgresql"
}
generator client {
  provider = "prisma-client-js"
}

///////////////////////////////////////////////////////////
// ENUMS
///////////////////////////////////////////////////////////

enum Role {
  MANAGER
  DISPATCHER
  SAFETY
  FINANCE
}

enum VehicleStatus {
  AVAILABLE
  ON_TRIP
  IN_SHOP
  RETIRED
}

enum DriverStatus {
  ON_DUTY
  ON_TRIP
  SUSPENDED
}

enum TripStatus {
  DRAFT
  DISPATCHED
  COMPLETED
  CANCELLED
}

///////////////////////////////////////////////////////////
// USER
///////////////////////////////////////////////////////////

model User {
  id               String   @id @default(uuid())
  name             String
  email            String   @unique
  password         String
  role             Role

  resetToken       String?
  resetTokenExpiry DateTime?

  createdAt        DateTime @default(now())
}

///////////////////////////////////////////////////////////
// VEHICLE
///////////////////////////////////////////////////////////

model Vehicle {
  id               Int            @id @default(autoincrement())
  model            String
  type             String
  licensePlate     String         @unique
  year             Int
  mileage          Int
  fuelType         String
  capacity         Int
  status           VehicleStatus  @default(AVAILABLE)

  odometer         Int            @default(0)


  totalFuelCost    Float          @default(0)
  totalMaintenance Float          @default(0)

  trips            Trip[]
  maintenances     Maintenance[]

  createdAt        DateTime @default(now())
}

///////////////////////////////////////////////////////////
// DRIVER
///////////////////////////////////////////////////////////

model Driver {
  id                 Int           @id @default(autoincrement())
  name               String
  licenseNumber      String        @unique
  licenseExpiryDate  DateTime      @db.Date
  experience         Int
  phone              String
  safetyRating       Float         @default(5)
  fatigue            Int           @default(0)
  status             DriverStatus  @default(ON_DUTY)

  trips              Trip[]

  createdAt          DateTime @default(now())
}

///////////////////////////////////////////////////////////
// TRIP
///////////////////////////////////////////////////////////

model Trip {
  id              Int         @id @default(autoincrement())

  vehicleId       Int
  driverId        Int

  cargoWeight     Int
  distance        Int
  origin          String
  destination     String

  fuelCost        Float       @default(0)
  maintenanceCost Float       @default(0)
  revenue         Float       @default(0)

  status          TripStatus  @default(DRAFT)
  createdAt       DateTime    @default(now())

  vehicle         Vehicle     @relation(fields: [vehicleId], references: [id])
  driver          Driver      @relation(fields: [driverId], references: [id])
}

///////////////////////////////////////////////////////////
// MAINTENANCE
///////////////////////////////////////////////////////////

model Maintenance {
  id         Int      @id @default(autoincrement())
  vehicleId  Int
  notes      String
  cost       Float    @default(0)
  date       DateTime @default(now())

  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])
}
